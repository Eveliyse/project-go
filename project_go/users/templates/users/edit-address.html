{% extends "base.html" %}

{% block content %}
<div id="current-address">
    {% if user_address %}
        <form id="edit-address" method="post" action="{% url 'users:editaddress' user_address.id %}">
    {% else %}
        <form id="edit-address" method="post" action="{% url 'users:addaddress' %}">
    {% endif %}
        {% csrf_token %}
        <table>
            {{ form.as_table }}
</table>
                <input type="submit" value="Save Changes" />
        <input type="hidden" name="next" value="{{ next }}" />
    </form>
            
    {% if user_address %}
<form method="post" action="{% url 'users:deleteaddress' user_address.id %}">
                {% csrf_token %}
        <input type="submit" value="Delete Address" />
        <input type="hidden" name="next" value="{{ next }}" />
    </form>
    {% endif %}
            
             {% for address in user_addresses %}
    <p>
        {{ address.id }}
        {{ address.line_1 }}
        {{ address.line_2 }}
        {{ address.town }}
        {{ address.postcode }}
        
      <a class="edit" href="{% url 'users:editaddress' address.id %}">Edit</a>    </p>
    {% endfor %}
    
            
            
</div>
{% endblock %}
    
    {% block jscript %}
    
    $('.edit').click(function(event) {
      event.preventDefault();

      $('#current-address').load(this.href);
   });
    
    var frm = $('#edit-address');
    frm.submit(function () {
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                $("#current-address").html(data);
            },
            error: function(data) {
                $("#current-address").html("Something went wrong!");
            }
        });
        return false;
    });
    
    {% endblock %}