{% extends "base.html" %}

{% block content %}
<div class="content-card">
    {% if project %}
    <h1>Edit Project</h1>
        <form method="post" action="{% url 'projects:edit' project.id %}" enctype="multipart/form-data">
    {% else %}
    <h1>Create Project</h1>
        <form method="post" action="{% url 'projects:create' %}" enctype="multipart/form-data">
    {% endif %}

    {% csrf_token %}
    <table class="form-table">
        {{ form.as_table }}
    </table>

    {% if project %}
        <img src="{{ project.image.url }}" />
        <input class="right" type="submit" name="project" value="Save Project" />
                
    {% else %}
        <input class="right" type="submit" name="project" value="Create Project" />
        
    {% endif %}        
            <div class="clear"></div>
        </form>
    </div>
            
    {% if project %}
    <div class="content-card">
                <div id="pledge-rewards">
                    <h2>{{ project.title }} Pledge Rewards</h2>
        {% for pledge in pledges %}
            <p>{{ pledge }}</p>
        {% endfor %}
        <a class="edit" href="{% url 'projects:pledgerewards' project.id %}">Edit and delete pledges</a>
    </div>
    </div>
{% endif %} 
            
{% endblock %}
            
{% block jscript %}

    $('#pledge-rewards').on('click', '.edit', function(event) {
      event.preventDefault();

      $('#pledge-rewards').load(this.href + ' #pledge-rewards > *');
   });

    $('#pledge-rewards').on('submit', '.pledgereward' , function () {
        var frm = $(this);
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                $("#pledge-rewards").empty().append(data);
            },
            error: function(data) {
                $("#pledge-rewards").html("Something went wrong!");
            }
        });
        return false;
    });

{% endblock %}